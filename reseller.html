<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reseller Area - Lunor</title>

    <meta name="title" content="Lunor">
    <meta name="description" content="The leading roblox script hub of 2026, dont waste your time on others :)">
    <meta name="theme-color" content="#ffffff">
    <meta name="author" content="bleh2rich">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://writeprocessmem.github.io/lunor/">
    <meta property="og:title" content="Lunor">
    <meta property="og:description" content="The leading roblox script hub of 2026, dont waste your time on others :)">
    <meta property="og:image"
        content="https://raw.githubusercontent.com/writeprocessmem/lunor/refs/heads/main/assets/LunorBanner.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Lunor">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://writeprocessmem.github.io/lunor/">
    <meta name="twitter:title" content="Lunor">
    <meta name="twitter:description" content="The leading roblox script hub of 2026, dont waste your time on others :)">
    <meta name="twitter:image"
        content="https://raw.githubusercontent.com/writeprocessmem/lunor/refs/heads/main/assets/LunorBanner.png">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Lunor">
    <link rel="apple-touch-icon" href="assets/icon.png">
    <link rel="apple-touch-startup-image" href="assets/LunorBanner.png">

    <link rel="icon" type="image/png" sizes="32x32" href="assets/icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/icon.png">

    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        * {
            cursor: none !important;
        }

        .shadcn-select {
            position: relative;
            width: 100%;
        }

        .shadcn-select-trigger {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            height: 2.5rem;
            padding: 0 0.75rem;
            font-size: 0.875rem;
            line-height: 1.25rem;
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 0.5rem;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
            outline: none;
        }

        .shadcn-select-trigger:hover {
            border-color: #444;
            background: #111;
        }

        .shadcn-select-trigger:focus {
            border-color: #666;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        .shadcn-select-trigger[aria-expanded="true"] {
            border-color: #666;
        }

        .shadcn-select-trigger[aria-expanded="true"] .shadcn-select-icon {
            transform: rotate(180deg);
        }

        .shadcn-select-value {
            flex: 1;
            text-align: left;
            color: #fff;
        }

        .shadcn-select-value:empty::before {
            content: "Select...";
            color: #666;
        }

        .shadcn-select-icon {
            width: 1rem;
            height: 1rem;
            margin-left: 0.5rem;
            color: #999;
            transition: transform 0.2s;
        }

        .shadcn-select-content {
            position: absolute;
            top: calc(100% + 0.25rem);
            left: 0;
            right: 0;
            z-index: 50;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 0.5rem;
            padding: 0.25rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-0.5rem);
            transition: all 0.2s;
            max-height: 20rem;
            overflow-y: auto;
        }

        .shadcn-select-content.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .shadcn-select-item {
            position: relative;
            display: flex;
            align-items: center;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            line-height: 1.25rem;
            color: #fff;
            cursor: pointer;
            border-radius: 0.375rem;
            transition: all 0.15s;
            user-select: none;
        }

        .shadcn-select-item:hover {
            background: #222;
            color: #fff;
        }

        .shadcn-select-item:focus {
            background: #222;
            outline: none;
        }

        .shadcn-select-item[data-selected="true"] {
            background: #2a2a2a;
            color: #fff;
        }

        .dropdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 40;
            display: none;
        }

        .dropdown-overlay.show {
            display: block;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
            appearance: textfield;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const year = new Date().getFullYear();
            const desc = "The leading roblox script hub of " + year + ", dont waste your time on others :)";
            document.querySelector('meta[name="description"]').setAttribute('content', desc);
            document.querySelector('meta[property="og:description"]').setAttribute('content', desc);
            document.querySelector('meta[name="twitter:description"]').setAttribute('content', desc);
        });
    </script>
</head>

<body>

    <div class="custom-cursor" id="cursor"></div>

    <div class="corner-glow corner-glow-tl"></div>
    <div class="corner-glow corner-glow-tr"></div>
    <div class="corner-glow corner-glow-bl"></div>
    <div class="corner-glow corner-glow-br"></div>

    <div class="sale-banner" id="saleBanner">
        <span class="sale-text">
            <i data-lucide="moon" class="sale-icon-lucide"></i>
            <span id="saleMessage">LAUNCH SPECIAL! Use code <strong id="saleCode">MOON20</strong> for <strong
                    id="salePercent">20%</strong> OFF</span>
        </span>
        <button class="sale-close" onclick="closeSaleBanner()">×</button>
    </div>

    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img src="assets/icon.png" alt="Lunor" class="logo-icon">
                <span class="logo-text">Lunor</span>
            </a>

            <div class="nav-links">
                <a href="index.html" class="nav-link">Home</a>
                <a href="products.html" class="nav-link">Products</a>
                <a href="support.html" class="nav-link">Support</a>
                <a href="affiliate.html" class="nav-link">Affiliate</a>
            </div>

            <div class="nav-actions">
                <button class="cart-btn" onclick="toggleCart()">
                    <i data-lucide="shopping-cart"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </button>
            </div>

            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <div class="mobile-menu" id="mobileMenu">
        <a href="index.html" class="mobile-link">Home</a>
        <a href="products.html" class="mobile-link">Products</a>
        <a href="support.html" class="mobile-link">Support</a>
        <a href="affiliate.html" class="mobile-link">Affiliate</a>
    </div>

    <section class="page-header">
        <div class="container"
            style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
            <div>
                <h1>Reseller Area</h1>
                <p>Track your affiliate performance and earnings</p>
            </div>
            <button onclick="logout()" class="btn btn-secondary"
                style="display: inline-flex; align-items: center; gap: 0.5rem;">
                <i data-lucide="log-out" style="width: 18px; height: 18px;"></i>
                <span>Logout</span>
            </button>
        </div>
    </section>

    <section class="stats" style="padding: 4rem 0;">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-item">
                    <i data-lucide="users" class="stat-icon"></i>
                    <span class="stat-number" id="referredCustomers">0</span>
                    <span class="stat-label">Referred Customers</span>
                </div>
                <div class="stat-item">
                    <i data-lucide="dollar-sign" class="stat-icon"></i>
                    <span class="stat-number" id="totalSales">$0.00</span>
                    <span class="stat-label">Total Sales</span>
                </div>
                <div class="stat-item">
                    <i data-lucide="trending-up" class="stat-icon"></i>
                    <span class="stat-number" id="commissionEarned">$0.00</span>
                    <span class="stat-label">Commission Earned</span>
                </div>
                <div class="stat-item">
                    <i data-lucide="mouse-pointer" class="stat-icon"></i>
                    <span class="stat-number" id="affiliateClicks">0</span>
                    <span class="stat-label">Affiliate Link Clicks</span>
                </div>
            </div>
        </div>
    </section>

    <section class="support-content" style="padding-top: 2rem;">
        <div class="container">
            <div class="support-grid">
                <div class="support-section">
                    <h2>
                        <i data-lucide="link"></i>
                        Your Affiliate Link
                    </h2>
                    <div
                        style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 1.5rem; margin-top: 1rem;">
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <!-- Link Display -->
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <input type="text" id="affiliateLink" value="https://lunor.wtf/?ref=YOUR_CODE" readonly
                                    style="flex: 1; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; padding: 0.75rem 1rem; color: #fff; font-family: monospace; font-size: 0.9rem;">
                                <button onclick="copyAffiliateLink()" class="btn btn-secondary"
                                    style="white-space: nowrap;">
                                    <i data-lucide="copy" style="width: 18px; height: 18px;"></i>
                                    Copy
                                </button>
                            </div>

                            <!-- Edit Code -->
                            <div>
                                <h3 style="font-size: 0.9rem; color: #aaa; margin-bottom: 0.5rem; font-weight: 500;">
                                    Customize Code</h3>
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <input type="text" id="customCodeInput" placeholder="Enter custom code"
                                        style="flex: 1; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; padding: 0.75rem 1rem; color: #fff; font-family: monospace; font-size: 0.9rem;">
                                    <button onclick="updateReferralCode()" class="btn btn-primary"
                                        style="white-space: nowrap;">
                                        Save
                                    </button>
                                </div>
                                <p style="color: #666; font-size: 0.8rem; margin-top: 0.5rem; margin-bottom: 0;">
                                    Alphanumeric characters only. 3-20 characters.
                                </p>
                            </div>
                        </div>
                    </div>
                    <p style="color: #aaa; font-size: 0.9rem; margin: 0;">
                        Share this link to start earning commissions on every sale!
                    </p>
                </div>
            </div>

            <div class="support-section">
                <h2>
                    <i data-lucide="info"></i>
                    Quick Info
                </h2>
                <div style="margin-top: 1rem;">
                    <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 1.5rem;">
                        <div style="margin-bottom: 1rem;">
                            <p style="color: #aaa; margin-bottom: 0.5rem;">Commission Rate</p>
                            <p style="color: #fff; font-size: 1.5rem; font-weight: 600; margin: 0;">Up to 30%</p>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <p style="color: #aaa; margin-bottom: 0.5rem;">Withdrawal Cooldown</p>
                            <p style="color: #fff; font-size: 1.5rem; font-weight: 600; margin: 0;">7 Days</p>
                        </div>
                        <div>
                            <p style="color: #aaa; margin-bottom: 0.5rem;">Payment Methods</p>
                            <p style="color: #fff; font-size: 1rem; margin: 0;">PayPal & Crypto</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </section>

    <section class="support-content" style="padding-top: 2rem;">
        <div class="container">
            <div class="support-grid">
                <div class="support-section">
                    <h2>
                        <i data-lucide="wallet"></i>
                        Balance
                    </h2>
                    <div
                        style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 2rem; margin-top: 1rem; text-align: center;">
                        <p style="color: #aaa; margin-bottom: 0.5rem; font-size: 0.9rem;">Available Balance</p>
                        <p style="color: #fff; font-size: 3rem; font-weight: 700; margin: 0;" id="availableBalance">
                            $1,234.56</p>
                        <p style="color: #666; font-size: 0.85rem; margin-top: 0.5rem; margin-bottom: 0;">Pending:
                            <span id="pendingBalance">$0.00</span>
                        </p>
                    </div>
                </div>

                <div class="support-section">
                    <h2>
                        <i data-lucide="arrow-down-circle"></i>
                        Withdraw
                    </h2>
                    <div
                        style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 1.5rem; margin-top: 1rem;">
                        <form id="withdrawForm" onsubmit="handleWithdraw(event)">
                            <div style="margin-bottom: 1rem;">
                                <label
                                    style="display: block; color: #aaa; margin-bottom: 0.5rem; font-size: 0.9rem;">Amount</label>
                                <input type="number" id="withdrawAmount" step="0.01" min="0.01" required
                                    placeholder="0.00"
                                    style="width: 100%; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; padding: 0.75rem 1rem; color: #fff; font-size: 1rem;">
                            </div>

                            <div style="margin-bottom: 1rem; position: relative;">
                                <label
                                    style="display: block; color: #aaa; margin-bottom: 0.5rem; font-size: 0.9rem; font-weight: 500;">Payment
                                    Method</label>
                                <div class="shadcn-select" style="position: relative;">
                                    <button type="button" id="paymentMethodBtn" class="shadcn-select-trigger"
                                        onclick="toggleDropdown('paymentMethod')" aria-haspopup="listbox"
                                        aria-expanded="false">
                                        <span id="paymentMethodValue" class="shadcn-select-value">Select payment
                                            method</span>
                                        <i data-lucide="chevron-down" class="shadcn-select-icon"></i>
                                    </button>
                                    <div id="paymentMethodDropdown" class="shadcn-select-content" role="listbox">
                                        <div class="shadcn-select-item"
                                            onclick="selectOption('paymentMethod', '', 'Select payment method', this)"
                                            role="option">
                                            Select payment method
                                        </div>
                                        <div class="shadcn-select-item"
                                            onclick="selectOption('paymentMethod', 'paypal', 'PayPal', this)"
                                            role="option">
                                            PayPal
                                        </div>
                                        <div class="shadcn-select-item"
                                            onclick="selectOption('paymentMethod', 'crypto', 'Crypto', this)"
                                            role="option">
                                            Crypto
                                        </div>
                                    </div>
                                    <input type="hidden" id="paymentMethod" required>
                                </div>
                            </div>

                            <div id="paypalFields" style="display: none; margin-bottom: 1rem;">
                                <label
                                    style="display: block; color: #aaa; margin-bottom: 0.5rem; font-size: 0.9rem;">PayPal
                                    Email</label>
                                <input type="email" id="paypalEmail" placeholder="your@email.com"
                                    style="width: 100%; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; padding: 0.75rem 1rem; color: #fff; font-size: 1rem;">
                            </div>

                            <div id="cryptoFields" style="display: none;">
                                <div style="margin-bottom: 1rem; position: relative;">
                                    <label
                                        style="display: block; color: #aaa; margin-bottom: 0.5rem; font-size: 0.9rem; font-weight: 500;">Cryptocurrency</label>
                                    <div class="shadcn-select" style="position: relative;">
                                        <button type="button" id="cryptoTypeBtn" class="shadcn-select-trigger"
                                            onclick="toggleDropdown('cryptoType')" aria-haspopup="listbox"
                                            aria-expanded="false">
                                            <span id="cryptoTypeValue" class="shadcn-select-value">Bitcoin (BTC)</span>
                                            <i data-lucide="chevron-down" class="shadcn-select-icon"></i>
                                        </button>
                                        <div id="cryptoTypeDropdown" class="shadcn-select-content" role="listbox">
                                            <div class="shadcn-select-item"
                                                onclick="selectOption('cryptoType', 'bitcoin', 'Bitcoin (BTC)', this)"
                                                role="option" data-selected="true">
                                                Bitcoin (BTC)
                                            </div>
                                            <div class="shadcn-select-item"
                                                onclick="selectOption('cryptoType', 'litecoin', 'Litecoin (LTC)', this)"
                                                role="option">
                                                Litecoin (LTC)
                                            </div>
                                        </div>
                                        <input type="hidden" id="cryptoType" value="bitcoin">
                                    </div>
                                </div>
                                <div>
                                    <label
                                        style="display: block; color: #aaa; margin-bottom: 0.5rem; font-size: 0.9rem;">Crypto
                                        Address</label>
                                    <input type="text" id="cryptoAddress" placeholder="Enter your wallet address"
                                        style="width: 100%; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; padding: 0.75rem 1rem; color: #fff; font-size: 1rem; font-family: monospace;">
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary btn-full" style="margin-top: 1.5rem;">
                                Request Withdrawal
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="support-content" style="padding-top: 2rem;">
        <div class="container">
            <div class="support-section" style="max-width: 100%;">
                <h2>
                    <i data-lucide="history"></i>
                    Withdrawal History
                </h2>
                <div
                    style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 1.5rem; margin-top: 1rem; overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 1px solid #333;">
                                <th
                                    style="text-align: left; padding: 0.75rem; color: #aaa; font-weight: 500; font-size: 0.9rem;">
                                    Date</th>
                                <th
                                    style="text-align: left; padding: 0.75rem; color: #aaa; font-weight: 500; font-size: 0.9rem;">
                                    Amount</th>
                                <th
                                    style="text-align: left; padding: 0.75rem; color: #aaa; font-weight: 500; font-size: 0.9rem;">
                                    Method</th>
                                <th
                                    style="text-align: left; padding: 0.75rem; color: #aaa; font-weight: 500; font-size: 0.9rem;">
                                    Details</th>
                                <th
                                    style="text-align: left; padding: 0.75rem; color: #aaa; font-weight: 500; font-size: 0.9rem;">
                                    Status</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawalHistory">

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <img src="assets/icon.png" alt="Lunor" class="footer-logo">
                    <span class="footer-name">Lunor</span>
                </div>
                <div class="footer-links">
                    <a href="terms.html">Terms of Service</a>
                    <a href="privacy.html">Privacy Policy</a>
                    <a href="https://discord.gg/lnr" target="_blank">Discord</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© <span id="currentYear"></span> Lunor. All rights reserved.</p>
                <p class="footer-credit" onclick="copyDiscordUsername()"
                    style="cursor: none; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'"
                    onmouseout="this.style.opacity='0.7'">Made by bleh2rich</p>
            </div>
        </div>
    </footer>

    <div id="discordNotification"
        style="position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 1rem 1.5rem; display: flex; align-items: center; gap: 12px; z-index: 10000; transition: bottom 0.3s ease; box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
        <svg viewBox="0 0 71 55" fill="#5865F2" width="24" height="24">
            <path
                d="M60.1 4.9C55.6 2.8 50.7 1.3 45.7.4c-.1 0-.2 0-.2.1-.7 1.1-1.4 2.6-1.9 3.7-5.5-.8-10.9-.8-16.3 0-.5-1.2-1.2-2.6-1.9-3.7 0-.1-.1-.1-.2-.1-5.1.9-9.9 2.4-14.4 4.5 0 0 0 0-.1.1C1.6 18.7-.9 32.1.3 45.4v.1c6.1 4.5 12 7.2 17.8 9 .1 0 .2 0 .2-.1 1.4-1.9 2.6-3.9 3.6-5.9.1-.1 0-.3-.1-.3-2-.8-3.8-1.7-5.6-2.7-.1-.1-.1-.3 0-.4.4-.3.8-.6 1.1-.9 0 0 .1-.1.2 0 11.6 5.3 24.2 5.3 35.7 0h.2c.4.3.7.6 1.1.9.1.1.1.3 0 .4-1.8 1.1-3.6 2-5.6 2.7-.1 0-.2.2-.1.3 1 2 2.2 4 3.6 5.9 0 .1.1.1.2.1 5.8-1.8 11.7-4.5 17.8-9v-.1c1.5-15.2-2.4-28.5-10.5-40.5zM23.7 37.3c-3.5 0-6.4-3.2-6.4-7.2s2.8-7.2 6.4-7.2c3.6 0 6.4 3.2 6.4 7.2s-2.9 7.2-6.4 7.2zm23.6 0c-3.5 0-6.4-3.2-6.4-7.2s2.8-7.2 6.4-7.2c3.6 0 6.5 3.2 6.4 7.2s-2.8 7.2-6.4 7.2z" />
        </svg>
        <span style="color: #fff; font-size: 0.9rem;" id="notificationText">Copied to clipboard</span>
    </div>

    <script>
        function copyDiscordUsername() {
            navigator.clipboard.writeText('bl_h_').then(function () {
                showNotification('Copied Discord username');
            });
        }

        function copyAffiliateLink() {
            const linkInput = document.getElementById('affiliateLink');
            linkInput.select();
            navigator.clipboard.writeText(linkInput.value).then(function () {
                showNotification('Affiliate link copied!');
            });
        }

        function showNotification(text) {
            const notification = document.getElementById('discordNotification');
            const notificationText = document.getElementById('notificationText');
            notificationText.textContent = text;
            notification.style.bottom = '2rem';
            setTimeout(function () {
                notification.style.bottom = '-100px';
            }, 2500);
        }

        let activeDropdown = null;

        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId + 'Dropdown');
            const trigger = document.getElementById(dropdownId + 'Btn');
            const overlay = document.getElementById('dropdownOverlay');

            if (activeDropdown && activeDropdown !== dropdown) {
                activeDropdown.classList.remove('show');
                const otherTrigger = activeDropdown.previousElementSibling;
                if (otherTrigger) {
                    otherTrigger.setAttribute('aria-expanded', 'false');
                }
            }

            const isOpen = dropdown.classList.contains('show');

            if (isOpen) {
                dropdown.classList.remove('show');
                trigger.setAttribute('aria-expanded', 'false');
                overlay.classList.remove('show');
                activeDropdown = null;
            } else {
                dropdown.classList.add('show');
                trigger.setAttribute('aria-expanded', 'true');
                overlay.classList.add('show');
                activeDropdown = dropdown;
            }
        }

        function selectOption(selectId, value, label, element) {
            const hiddenInput = document.getElementById(selectId);
            const valueSpan = document.getElementById(selectId + 'Value');
            const trigger = document.getElementById(selectId + 'Btn');

            hiddenInput.value = value;
            valueSpan.textContent = label;
            trigger.setAttribute('aria-expanded', 'false');

            const dropdown = document.getElementById(selectId + 'Dropdown');
            dropdown.classList.remove('show');
            document.getElementById('dropdownOverlay').classList.remove('show');
            activeDropdown = null;

            dropdown.querySelectorAll('.shadcn-select-item').forEach(item => {
                item.setAttribute('data-selected', 'false');
            });
            if (element) {
                element.setAttribute('data-selected', 'true');
            }

            if (selectId === 'paymentMethod') {
                togglePaymentFields();
            }

            lucide.createIcons();
        }

        function togglePaymentFields() {
            const paymentMethod = document.getElementById('paymentMethod').value;
            const paypalFields = document.getElementById('paypalFields');
            const cryptoFields = document.getElementById('cryptoFields');
            const paypalEmail = document.getElementById('paypalEmail');
            const cryptoAddress = document.getElementById('cryptoAddress');

            if (paymentMethod === 'paypal') {
                paypalFields.style.display = 'block';
                cryptoFields.style.display = 'none';
                paypalEmail.required = true;
                cryptoAddress.required = false;
            } else if (paymentMethod === 'crypto') {
                paypalFields.style.display = 'none';
                cryptoFields.style.display = 'block';
                paypalEmail.required = false;
                cryptoAddress.required = true;
            } else {
                paypalFields.style.display = 'none';
                cryptoFields.style.display = 'none';
                paypalEmail.required = false;
                cryptoAddress.required = false;
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            const overlay = document.createElement('div');
            overlay.id = 'dropdownOverlay';
            overlay.className = 'dropdown-overlay';
            overlay.onclick = function () {
                if (activeDropdown) {
                    activeDropdown.classList.remove('show');
                    const trigger = activeDropdown.previousElementSibling;
                    if (trigger) {
                        trigger.setAttribute('aria-expanded', 'false');
                    }
                    overlay.classList.remove('show');
                    activeDropdown = null;
                }
            };
            document.body.appendChild(overlay);
        });

        function handleWithdraw(event) {
            event.preventDefault();
            const amount = document.getElementById('withdrawAmount').value;
            const paymentMethod = document.getElementById('paymentMethod').value;

            showNotification('Withdrawal request submitted!');
            event.target.reset();

            document.getElementById('paymentMethodValue').textContent = 'Select payment method';
            document.getElementById('paymentMethod').value = '';
            document.getElementById('cryptoTypeValue').textContent = 'Bitcoin (BTC)';
            document.getElementById('cryptoType').value = 'bitcoin';

            togglePaymentFields();
        }

        function getStatusColor(status) {
            switch (status.toLowerCase()) {
                case 'processed':
                    return '#4ade80';
                case 'processing':
                    return '#fbbf24';
                case 'declined':
                    return '#ef4444';
                default:
                    return '#666';
            }
        }

        function loadWithdrawalHistory() {
            const withdrawals = [
                { date: '2026-01-15', amount: '$250.00', method: 'PayPal', details: 'user@example.com', status: 'Processed' },
                { date: '2026-01-12', amount: '$150.00', method: 'Bitcoin', details: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh', status: 'Processed' },
                { date: '2026-01-10', amount: '$75.50', method: 'PayPal', details: 'user@example.com', status: 'Processing' },
                { date: '2026-01-08', amount: '$200.00', method: 'Litecoin', details: 'ltc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh', status: 'Processing' },
                { date: '2026-01-05', amount: '$100.00', method: 'PayPal', details: 'invalid@email.com', status: 'Declined' },
            ];

            const tbody = document.getElementById('withdrawalHistory');
            tbody.innerHTML = '';

            withdrawals.forEach(withdrawal => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #333';
                row.style.transition = 'background 0.2s';
                row.onmouseover = () => row.style.background = '#222';
                row.onmouseout = () => row.style.background = 'transparent';

                const statusColor = getStatusColor(withdrawal.status);
                const truncatedDetails = withdrawal.details.length > 30
                    ? withdrawal.details.substring(0, 30) + '...'
                    : withdrawal.details;

                row.innerHTML = `
                    <td style="padding: 1rem; color: #fff;">${withdrawal.date}</td>
                    <td style="padding: 1rem; color: #fff; font-weight: 600;">${withdrawal.amount}</td>
                    <td style="padding: 1rem; color: #aaa;">${withdrawal.method}</td>
                    <td style="padding: 1rem; color: #aaa; font-family: monospace; font-size: 0.85rem;">${truncatedDetails}</td>
                    <td style="padding: 1rem;">
                        <span style="display: inline-block; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.85rem; font-weight: 500; background: ${statusColor}20; color: ${statusColor}; border: 1px solid ${statusColor}40;">
                            ${withdrawal.status}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>

    <div class="cart-overlay" id="cartOverlay" onclick="toggleCart()"></div>
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3>Your Cart</h3>
            <button class="cart-close" onclick="toggleCart()">×</button>
        </div>
        <div class="cart-items" id="cartItems"></div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cartTotal">$0.00</span>
            </div>
            <button class="btn btn-primary btn-full" onclick="checkout()">Checkout</button>
            <button class="btn btn-full" onclick="checkoutWithRobux()"
                style="margin-top: 0.5rem; background: linear-gradient(135deg, #00b06f 0%, #00d884 100%); color: white; border: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                <span style="font-weight: 700;">R$</span> Checkout With Robux
            </button>
        </div>
    </div>

    <div class="particles" id="particles"></div>

    <script src="js/config.js"></script>
    <script src="js/app.js"></script>
    <script src="js/effects.js"></script>
    <script>
        const WORKER_URL = 'https://lunor-checkout.re9ostedscripts.workers.dev';
        let affiliateToken = null;
        let currentAffiliate = null;

        async function initAuth() {
            const urlParams = new URLSearchParams(window.location.search);
            const urlToken = urlParams.get('token');

            if (urlToken) {
                affiliateToken = urlToken;
                localStorage.setItem('affiliateToken', urlToken);
                history.replaceState({}, document.title, 'reseller.html');
            } else {
                affiliateToken = localStorage.getItem('affiliateToken');
            }

            if (!affiliateToken) {
                window.location.href = 'affiliate.html';
                return false;
            }

            try {
                const response = await fetch(`${WORKER_URL}/api/affiliate/me`, {
                    headers: { 'Authorization': `Bearer ${affiliateToken}` }
                });

                if (!response.ok) {
                    localStorage.removeItem('affiliateToken');
                    window.location.href = 'affiliate.html';
                    return false;
                }

                currentAffiliate = await response.json();
                updateAffiliateUI();
                loadStats();
                loadWithdrawalHistoryFromAPI();
                return true;
            } catch (err) {
                localStorage.removeItem('affiliateToken');
                window.location.href = 'affiliate.html';
                return false;
            }
        }

        function updateAffiliateUI() {
            if (!currentAffiliate) return;

            const linkInput = document.getElementById('affiliateLink');
            if (linkInput) {
                linkInput.value = `https://lunor.wtf/?ref=${currentAffiliate.referral_code}`;
            }

            const codeInput = document.getElementById('customCodeInput');
            if (codeInput) {
                codeInput.value = currentAffiliate.referral_code;
            }

            const balanceEl = document.getElementById('availableBalance');
            if (balanceEl) {
                balanceEl.textContent = `$${parseFloat(currentAffiliate.available_balance || 0).toFixed(2)}`;
            }

            const pendingEl = document.getElementById('pendingBalance');
            if (pendingEl) {
                pendingEl.textContent = `$${parseFloat(currentAffiliate.pending_balance || 0).toFixed(2)}`;
            }
        }

        async function loadStats() {
            try {
                const response = await fetch(`${WORKER_URL}/api/affiliate/stats`, {
                    headers: { 'Authorization': `Bearer ${affiliateToken}` }
                });

                if (!response.ok) return;

                const data = await response.json();

                document.getElementById('referredCustomers').textContent = data.referrals || 0;
                document.getElementById('totalSales').textContent = `$${parseFloat(data.affiliate?.total_sales || 0).toFixed(2)}`;
                document.getElementById('commissionEarned').textContent = `$${parseFloat(data.affiliate?.total_commission || 0).toFixed(2)}`;
                document.getElementById('affiliateClicks').textContent = data.clicks || 0;

                lucide.createIcons();
            } catch (err) {
            }
        }

        async function loadWithdrawalHistoryFromAPI() {
            try {
                const response = await fetch(`${WORKER_URL}/api/affiliate/withdrawals`, {
                    headers: { 'Authorization': `Bearer ${affiliateToken}` }
                });

                if (!response.ok) return;

                const withdrawals = await response.json();
                const tbody = document.getElementById('withdrawalHistory');
                tbody.innerHTML = '';

                if (!withdrawals || withdrawals.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="padding: 2rem; text-align: center; color: #666;">No withdrawal history</td></tr>';
                    return;
                }

                withdrawals.forEach(withdrawal => {
                    const row = document.createElement('tr');
                    row.style.borderBottom = '1px solid #333';
                    row.style.transition = 'background 0.2s';
                    row.onmouseover = () => row.style.background = '#222';
                    row.onmouseout = () => row.style.background = 'transparent';

                    const statusColor = getStatusColor(withdrawal.status);
                    const date = new Date(withdrawal.created_at).toLocaleDateString();
                    const truncatedDetails = (withdrawal.payment_details || '').length > 30
                        ? withdrawal.payment_details.substring(0, 30) + '...'
                        : (withdrawal.payment_details || '-');

                    row.innerHTML = `
                        <td style="padding: 1rem; color: #fff;">${date}</td>
                        <td style="padding: 1rem; color: #fff; font-weight: 600;">$${parseFloat(withdrawal.amount).toFixed(2)}</td>
                        <td style="padding: 1rem; color: #aaa;">${withdrawal.method}</td>
                        <td style="padding: 1rem; color: #aaa; font-family: monospace; font-size: 0.85rem;">${truncatedDetails}</td>
                        <td style="padding: 1rem;">
                            <span style="display: inline-block; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.85rem; font-weight: 500; background: ${statusColor}20; color: ${statusColor}; border: 1px solid ${statusColor}40;">
                                ${withdrawal.status}
                            </span>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (err) {
            }
        }

        async function handleWithdraw(event) {
            event.preventDefault();

            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const paymentMethod = document.getElementById('paymentMethod').value;

            if (!paymentMethod) {
                showNotification('Please select a payment method');
                return;
            }

            let paymentDetails = '';
            if (paymentMethod === 'paypal') {
                paymentDetails = document.getElementById('paypalEmail').value;
                if (!paymentDetails) {
                    showNotification('Please enter your PayPal email');
                    return;
                }
            } else if (paymentMethod === 'crypto') {
                const cryptoType = document.getElementById('cryptoType').value;
                const cryptoAddress = document.getElementById('cryptoAddress').value;
                if (!cryptoAddress) {
                    showNotification('Please enter your crypto address');
                    return;
                }
                paymentDetails = `${cryptoType}: ${cryptoAddress}`;
            }

            try {
                const response = await fetch(`${WORKER_URL}/api/affiliate/withdraw`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${affiliateToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        amount: amount,
                        method: paymentMethod,
                        paymentDetails: paymentDetails
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    showNotification(error.error || 'Withdrawal failed');
                    return;
                }

                showNotification('Withdrawal request submitted!');
                event.target.reset();

                document.getElementById('paymentMethodValue').textContent = 'Select payment method';
                document.getElementById('paymentMethod').value = '';
                document.getElementById('cryptoTypeValue').textContent = 'Bitcoin (BTC)';
                document.getElementById('cryptoType').value = 'bitcoin';
                togglePaymentFields();

                loadStats();
                loadWithdrawalHistoryFromAPI();

                const meResponse = await fetch(`${WORKER_URL}/api/affiliate/me`, {
                    headers: { 'Authorization': `Bearer ${affiliateToken}` }
                });
                if (meResponse.ok) {
                    currentAffiliate = await meResponse.json();
                    updateAffiliateUI();
                }
            } catch (err) {
                showNotification('Withdrawal failed. Please try again.');
            }
        }

        async function updateReferralCode() {
            const newCode = document.getElementById('customCodeInput').value.trim();
            if (!newCode) return;

            try {
                const response = await fetch(`${WORKER_URL}/api/affiliate/update-code`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${affiliateToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ newCode })
                });

                const data = await response.json();

                if (!response.ok) {
                    showNotification(data.error || 'Failed to update code');
                    return;
                }

                currentAffiliate.referral_code = data.referral_code;
                updateAffiliateUI();
                showNotification('Referral code updated!');
            } catch (err) {
                showNotification('Failed to update code');
            }
        }

        function logout() {
            localStorage.removeItem('affiliateToken');
            window.location.href = 'affiliate.html';
        }

        lucide.createIcons();
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        initAuth();
    </script>
</body>

</html>
